<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="styele.css">
    <title>Dona Chiquinha</title>
</head>
<body>
      <section class="container">
        <header>
          <picture>
            <source media="(min-width: 900px)" srcset="">
            <source media="(min-width: 600px)" srcset="">
            <img src="" alt="">
          </picture>
        </header>
        <nav class="row">
            <ul>
                <li><a href="index.html">Ovos de Páscoa</a></li>
                <li><a href="">Cadastro</a></li>
                <li><a href="">Sobre</a></li>
                <li><a href="">Localização</a></li>
                <i data-toggle="modal" onclick="mostrarPedido()" data-target="#myModal" class="material-icons">shopping_cart</i>
            </ul>
        </nav>
            
            <!-- <header>Dona Chiquinha Ovos de Páscoa Artesanal </header> -->
        <section class="row lista">
          <section class="col-md-3 produto">
            <img src="image/ovos pascoa02.jpg" alt="">  
              <section class="titulo">Produto 00</section>
              <section class="descricao">Descrição do Produto</section>
              <section class="valor">R$ 100,00</section>
              <section class="bt menos">-</section>
              <section class="qt">0</section>
              <section class="bt mais">+</section>
          </section>
        </section>
      
        <!-- <footer>
          background: #6aabd2;
          height: 7rem;
        </footer> -->
      </section>
      <script>
        lista = [];
        function buscarListaProduto(){
          let ajax = new XMLHttpRequest();
          ajax.open("GET", "produtos.json");
          ajax.send();
          ajax.onload = function() {
              lista =JSON.parse(this.response);
              replicar();
          }
          
        }
        function replicar(){
          let i = 0;
          for (const p of lista) {
            let id = i;
            let produto = document.querySelector(".produto").cloneNode(true);
            
            produto.querySelector(".titulo").innerHTML = p.nome.toUpperCase();
            produto.querySelector("img").src = p.img;
            produto.querySelector(".valor").innerHTML = `R$ ${p.valor}`;
            produto.querySelector(".descricao").innerHTML = p.descricao;
            produto.querySelector(".qt").innerHTML = p.qt;

            produto.querySelector(".menos").addEventListener("click", function(){alterarQt(id, -1)});
            produto.querySelector(".mais").addEventListener("click", function(){alterarQt(id, 1)});

            document.querySelector(".lista").append(produto);
            i++;

          }
          document.querySelector(".produto").remove();
          
        }
        function alterarQt(id, qt) {
          let p = lista[id];
          p.qt += qt;
          if(p.qt < 0) p.qt = 0;
          document.getElementsByClassName("qt")[id].innerHTML = p.qt;
        
        }
        let msgModal = "";
        function mostrarPedido(){
          msgModal = "";
          let subTotal = 0;
          let total = 0;
          for (const produto of lista) {
            if (produto.qt > 0){
              subTotal = (produto.valor * produto.qt).toFixed(2);
              total += +subTotal;
              msgModal += `<p>${produto.nome.toUpperCase()} (R$ ${produto.valor} x ${produto.qt}) = ${subTotal}</p>`;
            }
          }
          if(msgModal == " "){
            msgModal = "<p>Nenhum produto selecionado.</p>";
            document.querySelector("#btEnviar").disabled = "disabled";
          }else {
            msgModal += `<b>Total ${total.toFixed(2)}</b>`
            document.querySelector("#btEnviar").disabled = "";
          }
          document.querySelector(".modal-body").innerHTML = msgModal;
        }

        function enviar(){
          let fone = '5561996602666';
          msgModal = msgModal.replaceAll("<p>","").replaceAll("</p>","\n");
          msgModal = msgModal.replaceAll("<b>","*").replaceAll("</b>","*");
          let nome = document.querySelector("#nome").value; 
          let endereco = document.querySelector("#endereco").value; 
          msgModal += `\nNome: *${nome}*`
          msgModal += `\nEndereco: *${endereco}*`
          msgModal = encodeURI(msgModal);

          link = `https://api.whatsapp.com/send?phone=${fone}&text=${msgModal}`;
          window.open(link,'_blanck')
     
        }

        buscarListaProduto();
      </script>
        <div class="modal fade" id="myModal" role="dialog">
          <div class="modal-dialog">
          
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Informações do Pedido</h4>
              </div>
              <div class="modal-body">
               
              </div>
              <div class="modal-footer form-inline">
                <input type="text" name="" id="nome" class="form-control" placeholder="Nome">
                <input type="text" name="" id="endereco" class="form-control" placeholder="Endereço">
                <button type="button" onclick="enviar()" class="btn btn-default" disabled id="btEnviar">Enviar</button>
              </div>
            </div>
            
          </div>
        </div>
</body>
</html>